/*
	Incident No.	: ONE-10385 Add OMNI settings table for journal processing job
	Responsible		: Adrian Chiorean
	Sprint			: Sun
	Date created	: 25.07.2019

	Description		: Add system settings for OMNIJOBUPDATEINTERVAL and OMNIJOBMAXRETRYCOUNTER
*/

USE LSPOSNET

IF NOT EXISTS( SELECT * FROM SYSTEMSETTINGSTYPE WHERE [GUID] = '2E8B5791-7DFC-4998-A5B2-C5828DDD8864')
	INSERT INTO SYSTEMSETTINGSTYPE ([GUID], [Description])
	 VALUES ('2E8B5791-7DFC-4998-A5B2-C5828DDD8864', 'Omni')
GO

IF NOT EXISTS(SELECT * FROM SYSTEMSETTINGS WHERE [GUID] = '8E4FB9D9-ABDB-42F3-B625-02573B5022DC')
	INSERT INTO SYSTEMSETTINGS ([GUID], [Name], [Value], [Description], UserCanOverride, [Type], DATAAREAID, Internal)
	VALUES ('8E4FB9D9-ABDB-42F3-B625-02573B5022DC', 'OmniJobUpdateInterval', '15', 'How often Site Service will process omni journals (in minutes)', 0, '2E8B5791-7DFC-4998-A5B2-C5828DDD8864', 'LSR', 1);
GO

IF NOT EXISTS(SELECT * FROM SYSTEMSETTINGS WHERE [GUID] = '13B9DA71-5FC7-4D34-A3E5-BD1BECDAFD74')
	INSERT INTO SYSTEMSETTINGS ([GUID], [Name], [Value], [Description], UserCanOverride, [Type], DATAAREAID, Internal)
	VALUES ('13B9DA71-5FC7-4D34-A3E5-BD1BECDAFD74', 'OmniJobMaxRetryCounter', '3', 'How many times Site Service will try to process an omni journal', 0, '2E8B5791-7DFC-4998-A5B2-C5828DDD8864', 'LSR', 1);
GO

IF NOT EXISTS(SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'OMNIJOURNAL' AND COLUMN_NAME = 'RETRYCOUNTER')
BEGIN
	ALTER TABLE OMNIJOURNAL ADD RETRYCOUNTER INT NOT NULL DEFAULT 0
	EXECUTE spDB_SetFieldDescription_1_0 'OMNIJOURNAL', 'RETRYCOUNTER', 'Number of times this journal was processed.';
END
GO