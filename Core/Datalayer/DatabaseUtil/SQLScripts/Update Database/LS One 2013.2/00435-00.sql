/*

	Incident No.	: N/A
	Responsible		: Birgir Kristmannsson
	Sprint			: LS One 2013.1\Sprint 2
	Date created	: 12.9.2013

	Description		:  Add current forms as a new form profile
*/

USE LSPOSNET

GO

IF (0 = (SELECT count(*) FROM [dbo].[POSFORMTYPE] WHERE [DATAAREAID] = 'LSR'))
BEGIN
    -- Use numbers above 200 for convenience for later script, see below where SYSTEMTYPE is updated
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('9662e62d-55df-40cf-b7e2-907fb770d60b','Receipt',201,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('72280c3e-3b01-46f8-a032-52240458470e','Card (for shop)',202,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('b8c00223-b8b6-4294-9224-91027e2dc322','Card (for customer)',203,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('89d761c2-2f12-47c9-9fd0-920a3920035b','Card return (for shop)',204,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('ed519fb2-e0b5-40f5-8314-f43a4f39d980','Card return (for customer)',205,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('a837ea63-94f5-41a3-a0ec-cc4e2ae73705','EFT message',206,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('46532f54-48fc-41e9-83b9-0b159fde0251','Customer account (for shop)',207,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('a9c42388-a17c-4051-aae6-36fd21d69d6c','Customer account (for customer)',208,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('d69ecdc4-9773-4826-8765-e6ecd1b87a11','Customer account return (for shop)',209,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('39c74cf0-8fd8-432f-a91a-b66176cf9545','Customer account return (for customer)',210,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('97b38622-fef0-4f53-9056-b9c770373b9a','Tender declaration',211,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('1f7eab75-b191-4352-b659-9335219357f9','Invoice',212,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('48b211bb-0a2c-4a26-a798-19164a692249','Remove tender',213,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('3db410f5-f6d8-4d47-b50d-7ce6c375e889','Customer account deposit',214,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('6d027264-2efd-49df-bdab-101d57098483','Credit memo',215,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('d5796d04-ec81-42f0-9516-63e167a288e3','Credit memo balance',216,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('cffcc36a-7d9a-4ce6-9fdc-f175466caa63','Float entry',217,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('0cf6de94-8ffd-478e-a9eb-b68b55da726b','Sales order',218,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('f4297c47-2937-4c6f-860d-1a03358b5bd2','Sales invoice',219,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('e00d900d-94bb-4a80-a394-25e9af0ce5b0','Gift card',220,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('03554c15-993b-45b4-b5e8-54a68f96097a','Suspended transaction',221,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('3aa6eaf9-912b-4261-a2e2-7711e727a4a4','Voided transaction',222,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('4ba1c3be-d108-4cd2-a6fa-585af7862bff','Card info',223,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('05753004-232e-4633-a8e1-a793ba4dd22d','Safe drop',224,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('0952b700-67e6-4f9a-9022-ea7bd6e67a1c','Safe drop reversal',225,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('aa02f72f-12ab-4259-bdea-0d9524100e2d','Bank drop',226,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('1c948af3-313d-4cc2-9750-0e608f45f5d5','Bank drop reversal',227,'LSR')
	INSERT INTO [dbo].[POSFORMTYPE] (ID, DESCRIPTION, SYSTEMTYPE, DATAAREAID) values ('b91ff052-1464-4e51-90ba-f3e9b843db0b','Loyalty payment',228,'LSR')
END

IF (0 = (SELECT count(*) FROM [dbo].[POSFORMPROFILE] WHERE [DATAAREAID] = 'LSR'))
BEGIN
	INSERT INTO [dbo].[POSFORMPROFILE] (PROFILEID,DESCRIPTION,DATAAREAID) VALUES ('0c7d790c-096c-4ed5-94b5-6b9814c87a46','Default form profile','LSR')

	DECLARE @ID NVARCHAR(100)
	DECLARE @TYPEID tinyint
	
	DECLARE CURRENTFORMS CURSOR FOR
		SELECT ID
		FROM POSISFORMLAYOUT

	OPEN CURRENTFORMS

	FETCH FROM CURRENTFORMS INTO @ID

	WHILE @@FETCH_STATUS = 0
	BEGIN
	    -- use the fact that the original forms have IDs that were = to the form layout id
		set @TYPEID = 200 + CAST(@ID as TINYINT)

		IF exists (select * from INFORMATION_SCHEMA.COLUMNS where TABLE_NAME = 'POSFORMPROFILELINES' AND COLUMN_NAME = 'FORMLAYOUTID')
		BEGIN
		EXEC('INSERT INTO [dbo].[POSFORMPROFILELINES] (PROFILEID,FORMLAYOUTID,FORMLAYOUTID,DATAAREAID) 
		    VALUES (''''0c7d790c-096c-4ed5-94b5-6b9814c87a46'''', (select ID from [dbo].[POSFORMTYPE] where SYSTEMTYPE=''' + @typeid + '''),' + @ID + ', ''''LSR'''')')
		END
		ELSE
		BEGIN
		EXEC('INSERT INTO [dbo].[POSFORMPROFILELINES] (PROFILEID,FORMTYPEID,FORMLAYOUTID,DATAAREAID) 
		    VALUES (''''0c7d790c-096c-4ed5-94b5-6b9814c87a46'''', (select ID from [dbo].[POSFORMTYPE] where SYSTEMTYPE=''' + @typeid + '''),' + @ID + ', ''''LSR'''')')
		END

		  FETCH NEXT FROM CURRENTFORMS INTO @ID
	END

	CLOSE CURRENTFORMS
	DEALLOCATE CURRENTFORMS
END

UPDATE [dbo].[POSFORMTYPE] set SYSTEMTYPE=(SYSTEMTYPE-200) WHERE SYSTEMTYPE>200
GO
