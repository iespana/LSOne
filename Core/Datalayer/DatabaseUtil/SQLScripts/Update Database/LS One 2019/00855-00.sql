/*
	Incident No.	: ONE-7940
	Responsible		: Adrian Chiorean
	Sprint			: Ferengi
	Date created	: 13.11.2018

	Description		: Add REPORTCATEGORY column to table REPORTS
*/

USE LSPOSNET

IF NOT EXISTS(SELECT 1 FROM INFORMATION_SCHEMA.COLUMNS WHERE TABLE_NAME = 'REPORTS' AND COLUMN_NAME = 'REPORTCATEGORY')
BEGIN
	ALTER TABLE REPORTS ADD REPORTCATEGORY INT NULL
END
GO

IF EXISTS(SELECT 1 WHERE COLUMNPROPERTY(OBJECT_ID('dbo.REPORTS', 'U'), 'REPORTCATEGORY', 'AllowsNull') = 1)
BEGIN
	-- Set all to generic
	UPDATE REPORTS SET REPORTCATEGORY = 2

	-- Set system financial reports
	UPDATE REPORTS SET REPORTCATEGORY = 1 WHERE REPORTGUID IN ('01398E70-0A0D-11E5-B939-0800200C9A66', 'C67891C0-44E8-11E5-B970-0800200C9A66', '5115EF40-BB4F-11E4-BB52-0800200C9A66')

	-- Set system inventory reports
	UPDATE REPORTS SET REPORTCATEGORY = 4 WHERE REPORTGUID IN ('940DFB40-FF23-11E4-B939-0800200C9A66', '6448FD30-3D28-11E6-BDF4-0800200C9A66', '96BF9CA0-2AE7-11E5-A2CB-0800200C9A72')

	-- Set system sales reports
	UPDATE REPORTS SET REPORTCATEGORY = 6 WHERE REPORTGUID IN ('7474E7A0-2BBD-11E5-A2CB-0800200C9A66', '11DA2FF0-2BCD-11E5-A2CB-0800200C9A66', '05B0AB30-2BD9-11E5-A2CB-0800200C9A66', 'DAC36CD0-2BDF-11E5-A2CB-0800200C9A66', 'C0BDCA90-2BA5-11E5-A2CB-0800200C9A66')

	ALTER TABLE REPORTS ALTER COLUMN REPORTCATEGORY INT NOT NULL
END
GO